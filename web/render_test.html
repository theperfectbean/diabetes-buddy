<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Render Test</title>
</head>
<body>
    <h1>Assistant Message Render Test</h1>
    <div id="output" style="border: 1px solid #ccc; padding: 10px; white-space: normal;"></div>

    <script type="application/json" id="raw-data">
{
  "query": "How should I prepare for exercise?",
  "classification": "knowledge_base",
  "confidence": 0.9,
  "severity": "INFO",
  "answer": "Preparing for exercise with a closed-loop system is a bit different from traditional diabetes management, as the system will actively try to counteract things like \"sports carbs\" if you don't adjust your settings. The good news is that both Loop and AndroidAPS offer fantastic tools to help you manage your glucose during physical activity!\n\nHereâ€™s a breakdown of how you might prepare, depending on which system you're using:\n\n### General Approach for Exercise\n\nThe core idea is to reduce the amount of insulin your system is actively working with and potentially raise your target glucose range *before* and *during* your activity. This helps prevent lows. You'll want to think about making these changes in advance, as insulin takes time to act.\n\n### If You're Using Loop: Creating and Activating an Override Preset\n\nLoop uses something called an \"Override Preset\" to help you manage exercise.\n\n1.  **Create an Override Preset:**\n    *   Tap the **workout icon** (it often looks like a heart).\n    *   Tap the **plus sign (+) **in the upper right corner to start a new preset.\n    *   You'll need to **pick an emoji** and **give your preset a name** (like \"Gym Workout\" or \"Hiking\").\n    *   **Adjust your insulin needs:** The default is 100%, meaning no change. For exercise, you'll likely want to *reduce* this. In Loop 3, you can press and hold the orange bar in the \"Overall Insulin Needs\" section and move your finger left or right to adjust by 1% increments, giving you very fine control.\n    *   **Enter a target range:** This is optional, but many people find it helpful to set a slightly higher target range for exercise to give themselves more cushion against lows. If you do not set one, Loop will use your existing scheduled target.\n    *   Decide if you want the override to run **indefinitely or for a finite time** (e.g., 2 hours).\n    *   Once everything looks good, tap \"Save.\"\n\n2.  **Activate Your Override:**\n    *   When you're ready to start your activity, tap the **workout icon** again.\n    *   Select your saved exercise preset from the list. You can also create a new one on the fly or use a custom override for one-time use.\n    *   While the override is active, you'll see the heart icon highlighted in a blue square, and the \"HUD Status Row\" will indicate the active override's name. The glucose chart will also show a darker blue bar indicating your active target range and duration.\n\n3.  **Schedule in Advance:** A really helpful feature is the ability to **schedule an override for a future start time**. Tap the calendar icon next to a saved override to adjust its start time. For example, you could set an exercise override the night before an early morning workout, so you wake up with less insulin on board and at your desired exercise targets.\n\n4.  **Editing and Deactivating:** If your activity lasts longer or you need to adjust things, you can tap on the active override in the HUD Status Row to make temporary changes to its duration, insulin needs, or target value. These changes only affect the current override and aren't saved to your preset. To turn off an override at any time, simply tap the heart icon again. Overrides with a finite duration will automatically deactivate when their time is up.\n\n### If You're Using AndroidAPS: Profile Switches and Temp Targets\n\nAndroidAPS has a similar, but slightly different, approach for exercise, often using a combination of a \"Profile Switch\" and \"Activity Temp Targets.\"\n\n1.  **Rethink \"Sports Carbs\":** If you typically eat specific carbs for sports, be aware that AndroidAPS will recognize them and might try to correct them with insulin. So, you'll want to adjust your strategy.\n\n2.  **Key Steps for Exercise:**\n    *   **Make a Profile Switch to less than 100%:** This is a crucial step. A Profile Percentage applies a proportionate reduction or increase across your basal rates, Insulin Sensitivity Factor (ISF), and Insulin-to-Carb (I:C) ratios. This ensures a balanced adjustment by the system, rather than just reducing basal insulin. For example, switching to 70% would reduce your basal, ISF, and I:C by 30%.\n        *   To do this, **long-press** on your profile name on the AAPS homescreen.\n        *   Select your desired profile and then adjust the 'Percentage' field (e.g., 70%).\n        *   You can also set a 'Duration' for how long this percentage should be active. If left at zero, it runs indefinitely until you manually switch back.\n    *   **Set an Activity Temp Target:** This is a temporary glucose target above your standard target. This gives you a higher range to aim for during exercise, reducing the likelihood of lows.\n    *   **Disable SMB with High Temp Targets:** If you use Superbolus (SMB), make sure that \"Enable SMB with high temp targets\" and \"Enable SMB always\" are disabled. This prevents the system from giving microboluses when your glucose is still within your elevated exercise target range.\n\n3.  **Timing is Key:** Just like with Loop, it's really important to make these changes *in time* before your sport begins, and also consider how you'll manage your settings *after* the activity, especially regarding muscle glycogen replenishment.\n\n4.  **Individualization:** The specific percentage for your profile switch, the value for your activity temp target, and the best timing for these changes are very individual. It's always best to start on the safe side (meaning a lower profile percentage and a higher temp target) and observe how your body responds.\n\n5.  **Automation:** If you do sports regularly at the same time (i.e. sports class in your gym) you can even consider using \"Automations\" in AndroidAPS to automatically apply your profile switch and temp target settings.\n\nIn both systems, the goal is to give your body less insulin during activity, to avoid hypoglycemia. Always pay attention to your body's signals and your CGM readings, especially when trying new settings for exercise!\n\nðŸ“š **Clinical Evidence:**\n- This aligns with ADA 2026 Standards Section 7 recommendations for diabetes technology\n- The Australian Diabetes Guidelines (Section 3.1-3.3) provide evidence for technology benefits\n- This aligns with ADA 2026 Standards Section 6 glycemic targets\n- This aligns with ADA 2026 Standards Section 10 cardiovascular disease management\n\n---\n**Disclaimer:** This is educational information only. Always consult your healthcare provider before making changes to your diabetes management routine.",
  "sources": [],
  "disclaimer": "This is educational information only. Always consult your healthcare provider before making changes to your diabetes management routine."
}
    </script>

    <script>
        // Extract the assistant text from the raw response
        const data = JSON.parse(document.getElementById('raw-data').textContent);
        const text = data.answer;

        // Apply the same textâ†’HTML transformation logic as web/static/app.js
        const formatted = text.replace(/\n\n/g, '<br><br>');

        // Set the output
        document.getElementById('output').innerHTML = formatted;
    </script>
</body>
</html>